<!DOCTYPE html>
<html lang="en-CA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Film Equipment Rentals - Camera, Lighting & Audio Gear | Rainscope Filmworks</title>
    <meta name="description" content="Rent professional film equipment in Vancouver, BC. Cameras, lighting, audio gear, and production equipment available for rent. Reliable, well-maintained gear at competitive rates.">
    <meta name="keywords" content="film equipment rental, camera rental Vancouver, lighting equipment rental, audio gear rental, production equipment rental, BC film rentals">
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <link rel="canonical" href="https://rainscopefilmworks.com/rentals.html">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="assets/images/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/images/favicon-16x16.png">
    <link rel="apple-touch-icon" sizes="180x180" href="assets/images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="assets/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="assets/images/android-chrome-512x512.png">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://rainscopefilmworks.com/rentals.html">
    <meta property="og:title" content="Film Equipment Rentals | Rainscope Filmworks">
    <meta property="og:description" content="Rent professional film equipment in Vancouver, BC. Cameras, lighting, audio gear, and production equipment available.">
    <meta property="og:image" content="https://rainscopefilmworks.com/assets/images/logo.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Film Equipment Rentals - Rainscope Filmworks">
    <meta property="og:locale" content="en_CA">
    <meta property="og:site_name" content="Rainscope Filmworks">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://rainscopefilmworks.com/rentals.html">
    <meta name="twitter:title" content="Film Equipment Rentals | Rainscope Filmworks">
    <meta name="twitter:description" content="Rent professional film equipment in Vancouver, BC. Cameras, lighting, audio gear, and production equipment available.">
    <meta name="twitter:image" content="https://rainscopefilmworks.com/assets/images/logo.png">
    <meta name="twitter:image:alt" content="Film Equipment Rentals - Rainscope Filmworks">
    
    <!-- Resource Hints -->
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <link rel="preconnect" href="https://www.google.com">
    <link rel="dns-prefetch" href="https://www.google.com">
    
    <!-- Preload Critical Resources -->
    <link rel="preload" as="image" href="assets/images/logo.png">
    
    <link rel="stylesheet" href="assets/css/styles.css">
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-7RRQQ33JKM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-7RRQQ33JKM');
    </script>
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Service",
      "name": "Film Equipment Rentals",
      "description": "Rent professional film equipment in Vancouver, BC. Cameras, lighting, audio gear, and production equipment available for rent. Reliable, well-maintained gear at competitive rates.",
      "url": "https://rainscopefilmworks.com/rentals.html",
      "provider": {
        "@type": "LocalBusiness",
        "name": "Rainscope Filmworks",
        "telephone": "604-910-2845",
        "email": "rentals@rainscopefilmworks.com",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "1868 Glen Dr #235",
          "addressLocality": "Vancouver",
          "addressRegion": "BC",
          "postalCode": "V6A 4K4",
          "addressCountry": "CA"
        }
      },
      "serviceType": "Equipment Rental",
      "areaServed": [
        {
          "@type": "City",
          "name": "Vancouver",
          "@id": "https://www.wikidata.org/wiki/Q24639"
        },
        {
          "@type": "City",
          "name": "Burnaby"
        },
        {
          "@type": "City",
          "name": "Richmond"
        },
        {
          "@type": "City",
          "name": "Surrey"
        },
        {
          "@type": "City",
          "name": "Coquitlam"
        },
        {
          "@type": "City",
          "name": "North Vancouver"
        },
        {
          "@type": "City",
          "name": "West Vancouver"
        },
        {
          "@type": "City",
          "name": "New Westminster"
        },
        {
          "@type": "AdministrativeArea",
          "name": "Greater Vancouver",
          "@id": "https://www.wikidata.org/wiki/Q205047"
        },
        {
          "@type": "State",
          "name": "British Columbia",
          "@id": "https://www.wikidata.org/wiki/Q1974"
        }
      ],
      "availableChannel": {
        "@type": "ServiceChannel",
        "serviceUrl": "https://rainscopefilmworks.com/rentals.html",
        "servicePhone": "604-910-2845"
      },
      "breadcrumb": {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://rainscopefilmworks.com/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "Rentals",
            "item": "https://rainscopefilmworks.com/rentals.html"
          }
        ]
      }
    }
    </script>
    
    <style>
    /* Rentals App Styles */
    :root{
      --rs-bg:#173633; --rs-card:#fff; --rs-text:#131417; --rs-muted:#6b7280;
      --rs-border:rgba(255, 255, 255, 0.1); --rs-accent:#2B3E5E; --rs-radius:12px;
      --rs-gap:clamp(10px, 1.6vw, 16px); --rs-pad:clamp(8px, 1.4vw, 12px);
      --rs-font:clamp(13px, 1.05vw, 15px);
      --rs-chip-h:clamp(32px, 4.8vw, 36px);
      --vh: 1vh;
      --z-shell: 1; --z-sheet: 60; --z-toast: 70;
    }

    .rentals-wrapper *{box-sizing:border-box}
    .rentals-wrapper .rs{background:var(--rs-bg);color:var(--rs-text);font:var(--rs-font)/1.6 -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif}

    /* centered shell up to 6000px */
    .rentals-wrapper .rs-shell{
      width:100%;
      max-width:6000px;
      margin-inline:auto;
      padding-left: calc(20px + env(safe-area-inset-left));
      padding-right: calc(20px + env(safe-area-inset-right));
    }
    
    /* Remove shell padding on desktop for full-width */
    @media (min-width: 961px) {
      .rentals-wrapper .rs-shell{
        padding-left: 0;
        padding-right: 0;
      }
    }

    /* global padding around everything - removed for edge-to-edge on desktop */
    .rentals-wrapper #rs-app{ padding:0; }
    
    /* >>> Full-bleed on mobile: apply to the GRID PARENT so Squarespace gutters don't constrain it */
    @media (max-width:960px){
      .rentals-wrapper #rs-app{
        width:100vw;
        max-width:100vw;
        margin-left:calc(50% - 50vw);
        margin-right:calc(50% - 50vw);
        padding-left:10px;
        padding-right:10px;
      }
    }

    /* Layout grid */
    .rentals-wrapper #rs-app{
      display:grid;
      gap:var(--rs-gap);
      padding-top:var(--rs-gap);
      padding-bottom:var(--rs-gap);
      grid-template-columns:260px 1fr 420px;
      grid-template-rows:56px 1fr;
      grid-template-areas:"top top top" "cats items cart";
    }

    /* Top */
    .rentals-wrapper .rs-top{
      grid-area:top;
      display:flex;
      align-items:center;
      gap:var(--rs-gap);
      background:#fff;
      border:1px solid #e6e7ea;
      border-radius:var(--rs-radius);
      padding:var(--rs-pad) calc(var(--rs-pad) + 2px);
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .rentals-wrapper #rs-search{
      flex:1;
      padding:.7rem .9rem;
      border:1px solid #e6e7ea;
      border-radius:10px;
      font-size:clamp(14px,1.05vw,16px);
      background:#fff;
      color:#131417;
    }
    .rentals-wrapper #rs-search:focus{
      outline:none;
      border-color:#2B3E5E;
      box-shadow:0 0 0 3px rgba(43, 62, 94, 0.1);
    }
    .rentals-wrapper .rs-toggle{
      border:1px solid #e6e7ea;
      background:#fff;
      border-radius:10px;
      padding:.55rem .7rem;
      line-height:1;
      cursor:pointer;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-toggle:hover{
      border-color:#2B3E5E;
      background:#f8f9fa;
    }
    .rentals-wrapper .rs-only-mobile{display:none;}
    .rentals-wrapper .rs-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      min-width:1.45em;
      height:1.45em;
      font-size:.78em;
      border-radius:999px;
      background:#111;
      color:#fff;
      margin-left:.5ch;
      padding:0 .45ch;
    }

    /* Categories panel */
    .rentals-wrapper .rs-cats{
      grid-area:cats;
      background:var(--rs-card);
      border:1px solid #e6e7ea;
      border-radius:var(--rs-radius);
      min-height:60vh;
      display:flex;
      flex-direction:column;
      overflow:hidden;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .rentals-wrapper .rs-cats-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-weight:700;
      padding:10px 12px;
      border-bottom:1px solid #e6e7ea;
      background:#fafbfc;
    }
    .rentals-wrapper .rs-close{
      border:none;
      background:transparent;
      font-size:18px;
      padding:4px 6px;
      cursor:pointer;
      color:#98a2b3;
    }

    /* >>> Responsive, wider chips */
    .rentals-wrapper .rs-cats-list{
      display:flex; flex-direction:column;
      gap:10px; padding:12px;
      overflow:auto; scrollbar-gutter:stable both-edges;
    }
    .rentals-wrapper .rs-cat{
      min-width:220px; max-width:100%;
      height:auto; min-height:var(--rs-chip-h);
      display:flex; align-items:center; justify-content:space-between;
      border:1px solid #e6e7ea; background:#fff; border-radius:10px;
      padding:.4rem 1.1rem; gap:.75rem; cursor:pointer;
      white-space:normal; text-align:left;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-cat:hover{
      border-color:#2B3E5E;
      background:#f8f9fa;
    }
    .rentals-wrapper .rs-cat.active{background:var(--rs-accent);color:#fff;border-color:var(--rs-accent)}
    .rentals-wrapper .rs-cat.active:hover{
      background:#3a5477;
      border-color:#3a5477;
    }
    .rentals-wrapper .rs-count{opacity:.9}

    /* Items grid */
    .rentals-wrapper .rs-items{
      grid-area:items;
      background:var(--rs-card);
      border:1px solid #e6e7ea;
      border-radius:var(--rs-radius);
      padding:clamp(1rem, 2vw, 1.5rem);
      display:flex;
      flex-direction:column;
      min-height:50vh;
      box-shadow:0 2px 8px rgba(0,0,0,0.05);
    }
    .rentals-wrapper .rs-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(240px,1fr));
      gap:var(--rs-gap);
    }
    .rentals-wrapper .rs-card{
      border:1px solid #e6e7ea;
      border-radius:12px;
      background:#fff;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-card:hover{
      border-color:#2B3E5E;
      box-shadow:0 4px 12px rgba(0,0,0,0.1);
      transform:translateY(-2px);
    }
    .rentals-wrapper .rs-img{
      aspect-ratio:9/16;
      object-fit:cover;
      width:100%;
      background:#eef1f4;
      display:block;
    }
    .rentals-wrapper .rs-body{
      padding:10px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }
    .rentals-wrapper .rs-title{font-weight:700;}
    .rentals-wrapper .rs-variant{
      width:100%;
      padding:.55rem;
      border:1px solid #e6e7ea;
      border-radius:10px;
      background:#fff;
      color:#131417;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-variant:focus{
      outline:none;
      border-color:#2B3E5E;
      box-shadow:0 0 0 3px rgba(43, 62, 94, 0.1);
    }
    .rentals-wrapper .rs-row{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .rentals-wrapper .rs-price{font-weight:700;}
    .rentals-wrapper .rs-add{
      padding:.55rem .8rem;
      border:1px solid var(--rs-accent);
      border-radius:10px;
      background:#2B3E5E;
      color:#fff;
      cursor:pointer;
      font-weight:600;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-add:hover{
      background:#3a5477;
      border-color:#3a5477;
      transform:translateY(-1px);
      box-shadow:0 2px 8px rgba(43, 62, 94, 0.3);
    }

    /* Cart (desktop) */
    .rentals-wrapper .rs-cart{
      grid-area:cart;
      background:var(--rs-card);
      border:1px solid #e6e7ea;
      border-radius:var(--rs-radius);
      display:flex;
      flex-direction:column;
      position:sticky;
      top:clamp(calc(66px + 1rem), calc(70px + 1rem), calc(70px + 1.5rem));
      align-self:start;
      max-height:calc(100vh - clamp(calc(66px + 2rem), calc(70px + 2rem), calc(70px + 2.5rem)));
      overflow:hidden;
      z-index:var(--z-shell);
      box-shadow:0 4px 20px rgba(0,0,0,0.1);
      transition:all 0.3s ease;
    }
    
    @media (min-width: 769px) {
      .rentals-wrapper .rs-cart{
        top:clamp(calc(166px + 1rem), calc(166px + 1.5rem), calc(180px + 2rem));
        max-height:calc(100vh - clamp(calc(166px + 2rem), calc(166px + 2.5rem), calc(180px + 3rem)));
      }
    }
    .rentals-wrapper .rs-cart-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      font-weight:800;
      padding:12px;
      border-bottom:1px solid #e6e7ea;
      background:#fafbfc;
    }
    .rentals-wrapper .rs-head-count{font-weight:600;opacity:.7;margin-left:6px;}
    .rentals-wrapper .rs-cart-scroll{
      flex:1;
      overflow-y:auto;
      overflow-x:hidden;
      padding:12px;
      min-height:0;
      -webkit-overflow-scrolling:touch;
      scrollbar-width:thin;
      scrollbar-color:rgba(0,0,0,0.2) transparent;
    }
    .rentals-wrapper .rs-cart-scroll::-webkit-scrollbar{
      width:6px;
    }
    .rentals-wrapper .rs-cart-scroll::-webkit-scrollbar-track{
      background:transparent;
    }
    .rentals-wrapper .rs-cart-scroll::-webkit-scrollbar-thumb{
      background:rgba(0,0,0,0.2);
      border-radius:3px;
    }
    .rentals-wrapper .rs-cart-scroll::-webkit-scrollbar-thumb:hover{
      background:rgba(0,0,0,0.3);
    }
    .rentals-wrapper .rs-cart-lines{display:flex;flex-direction:column;gap:8px;}
    .rentals-wrapper .rs-line{display:grid;grid-template-columns:1fr 100px 24px;gap:8px;align-items:center;}
    .rentals-wrapper .rs-line input[type=number]{
      width:100px;
      padding:.45rem;
      border:1px solid #e6e7ea;
      border-radius:10px;
      background:#fff;
      color:#131417;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-line input[type=number]:focus{
      outline:none;
      border-color:#2B3E5E;
      box-shadow:0 0 0 3px rgba(43, 62, 94, 0.1);
    }
    .rentals-wrapper .rs-remove{
      border:none;
      background:transparent;
      font-size:18px;
      cursor:pointer;
      color:#99a0a8;
    }
    .rentals-wrapper .rs-cart-footer{
      border-top:1px solid #e6e7ea;
      background:#fafbfc;
      margin-top:auto;
      padding:10px;
      display:grid;
      gap:10px;
    }
    .rentals-wrapper .rs-summary{
      padding:10px;
      border:1px dashed #e6e7ea;
      border-radius:12px;
      background:#fafbfc;
      font-size:13px;
      display:grid;
      gap:6px;
    }
    .rentals-wrapper .rs-total{font-weight:700;}
    .rentals-wrapper .rs-form{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
    .rentals-wrapper .rs-form input,.rentals-wrapper .rs-form textarea{
      padding:.55rem .7rem;
      border:1px solid #e6e7ea;
      border-radius:10px;
      grid-column:span 2;
      background:#fff;
      color:#131417;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-form input:focus,.rentals-wrapper .rs-form textarea:focus{
      outline:none;
      border-color:#2B3E5E;
      box-shadow:0 0 0 3px rgba(43, 62, 94, 0.1);
    }
    .rentals-wrapper .rs-row2{
      grid-column:span 2;
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:8px;
    }
    .rentals-wrapper .rs-label{
      display:block;
      font-size:12px;
      color:var(--rs-muted);
      margin-bottom:4px;
    }
    .rentals-wrapper .rs-actions{
      grid-column:span 2;
      display:flex;
      gap:10px;
      align-items:center;
    }
    .rentals-wrapper .rs-btn-primary{
      padding:.72rem .95rem;
      border:1px solid var(--rs-accent);
      border-radius:12px;
      background:#2B3E5E;
      color:#fff;
      cursor:pointer;
      font-weight:600;
      text-transform:uppercase;
      letter-spacing:0.5px;
      transition:all 0.3s ease;
    }
    .rentals-wrapper .rs-btn-primary:hover{
      background:#3a5477;
      border-color:#3a5477;
      transform:translateY(-1px);
      box-shadow:0 4px 12px rgba(43, 62, 94, 0.3);
    }
    .rentals-wrapper .rs-btn-primary:active{
      transform:translateY(0);
    }
    .rentals-wrapper .rs-status{font-size:13px;color:var(--rs-muted);}

    /* Tablet */
    @media (max-width:1100px){
      .rentals-wrapper #rs-app{grid-template-columns:220px 1fr 360px}
    }

    /* Mobile stacks */
    @media (max-width:960px){
      .rentals-wrapper #rs-app{grid-template-columns:1fr;grid-template-rows:auto auto auto auto;grid-template-areas:"top" "cats" "items" "cart"}
      .rentals-wrapper .rs-only-mobile{display:inline-flex}
      .rentals-wrapper .rs-cats{min-height:auto}
      /* mobile chips scroll horizontally */
      .rentals-wrapper .rs-cats-list{flex-direction:row;flex-wrap:nowrap}
      .rentals-wrapper .rs-cat{min-width:180px;flex-shrink:0}
      .rentals-wrapper .rs-line{grid-template-columns:1fr 90px 24px}
      .rentals-wrapper .rs-row2{grid-template-columns:1fr}
      .rentals-wrapper .rs-grid{grid-template-columns:repeat(2, minmax(0,1fr))}
    }

    /* Phone bottom sheet */
    @media (max-width:720px){
      .rentals-wrapper .rs-cart{
        position:fixed;left:0;right:0;bottom:0;
        height:calc(var(--vh, 1vh) * 100);
        border-radius:18px 18px 0 0; box-shadow:0 -14px 36px rgba(0,0,0,.22);
        z-index:var(--z-sheet); transition:transform .26s ease, visibility .26s ease;
        will-change:transform;
      }
      @supports (height: 100svh){ .rentals-wrapper .rs-cart{ height:100svh; } }
      @supports (height: 100dvh){ .rentals-wrapper .rs-cart{ height:100dvh; } }
      .rentals-wrapper .rs-cart[data-open="false"]{ transform:translateY(100%); visibility:hidden; pointer-events:none; }
      .rentals-wrapper .rs-cart[data-open="true"]{  transform:translateY(0);     visibility:visible; pointer-events:auto; }
      .rentals-wrapper .rs-cart-head{position:sticky;top:0;z-index:1}
      .rentals-wrapper .rs-cart-scroll{padding:12px 12px 4px}
      .rentals-wrapper .rs-cart-footer{position:sticky;bottom:0;z-index:1;padding:12px;border-top:1px solid var(--rs-border)}
    }

    /* Toast */
    .rentals-wrapper .rs-toast{
      position:fixed;left:50%;bottom:calc(16px + env(safe-area-inset-bottom));transform:translateX(-50%);
      background:#111;color:#fff;padding:.65rem .9rem;border-radius:999px;font-size:14px;opacity:0;pointer-events:none;
      transition:opacity .2s ease, transform .2s ease; z-index:var(--z-toast);
    }
    .rentals-wrapper .rs-toast.show{opacity:1;transform:translate(-50%, -6px)}
    @media (prefers-reduced-motion:reduce){ .rentals-wrapper .rs-cart{transition:none} .rentals-wrapper .rs-toast{transition:none} }

    /* Optional: lock page scroll when cart is open */
    .rentals-wrapper .rs-lock{height:100vh; overflow:hidden;}
   /* Desktop & tablet: no scrollbar for the chip list */
   .rentals-wrapper .rs-cats-list{
     overflow: visible;
     scrollbar-gutter: auto;
   }

   /* Mobile: horizontal scroll for chips row */
   @media (max-width:960px){
     .rentals-wrapper .rs-cats-list{
       overflow-x: auto;
       overflow-y: hidden;
       -webkit-overflow-scrolling: touch;
       scrollbar-gutter: stable;
     }
   }
   /* Desktop & tablet: chips fill the Categories panel, no scroll */
   .rentals-wrapper .rs-cats-list{
     display:flex;
     flex-direction:column;
     align-items:stretch;
     gap:10px;
     padding:12px;
     overflow:visible;
   }
   .rentals-wrapper .rs-cat{
     width:100%;
     min-width:0;
   }

   /* Mobile: horizontal row with fixed min-width chips */
   @media (max-width:960px){
     .rentals-wrapper .rs-cats-list{
       flex-direction:row;
       align-items:stretch;
       overflow-x:auto;
       overflow-y:hidden;
       -webkit-overflow-scrolling:touch;
     }
     .rentals-wrapper .rs-cat{
       width:auto;
       min-width:180px;
       flex-shrink:0;
     }
   }

   /* Page content wrapper */
   .page-content {
     margin-top: clamp(66px, calc(70px + 2.75rem), 80px);
     padding: 0;
     background: #173633;
     color: white;
     min-height: calc(100vh - clamp(66px, calc(70px + 2.75rem), 80px));
   }

   .rentals-wrapper {
     width: 100%;
     margin: 0;
     padding: clamp(2.75rem, 3.75vw, 3.75rem) 0 clamp(1rem, 2vw, 1.5rem) 0;
   }
   
   .rentals-wrapper h1 {
     padding: 0 clamp(1rem, 3vw, 2rem);
     margin-bottom: clamp(1rem, 2vw, 2rem);
     color: white;
     font-size: clamp(2rem, 4vw, 3rem);
     font-weight: 700;
     text-transform: uppercase;
     letter-spacing: 2px;
   }

   /* FAQ Section for Rentals - Modal Overlay */
   .rentals-faq-wrapper {
     position: fixed;
     top: 0;
     left: 0;
     right: 0;
     bottom: 0;
     z-index: 10000;
     display: flex;
     align-items: center;
     justify-content: center;
     padding: clamp(1rem, 3vw, 2rem);
     opacity: 0;
     visibility: hidden;
     transition: opacity 0.4s ease, visibility 0.4s ease;
     pointer-events: none;
     background: rgba(0, 0, 0, 0.3);
   }

   .rentals-faq-wrapper.visible {
     opacity: 1;
     visibility: visible;
     pointer-events: auto;
   }

   .rentals-faq-container {
     position: relative;
     z-index: 1;
     background: #173633;
     border: 2px solid rgba(255, 255, 255, 0.2);
     border-radius: 16px;
     padding: clamp(2rem, 4vw, 3rem);
     max-width: min(90vw, 700px);
     max-height: 85vh;
     overflow-y: auto;
     box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
     transform: scale(0.95);
     transition: transform 0.4s ease;
   }

   .rentals-faq-wrapper.visible .rentals-faq-container {
     transform: scale(1);
   }

   .rentals-faq-header {
     display: flex;
     justify-content: space-between;
     align-items: center;
     margin-bottom: clamp(1rem, 2vw, 1.5rem);
   }

   .rentals-faq-title {
     font-size: clamp(1.5rem, 3vw, 2rem);
     font-weight: 600;
     text-transform: uppercase;
     letter-spacing: 2px;
     color: white;
     margin: 0;
   }

   .rentals-faq-close {
     background: transparent;
     border: 2px solid rgba(255, 255, 255, 0.4);
     border-radius: 50%;
     width: 36px;
     height: 36px;
     display: flex;
     align-items: center;
     justify-content: center;
     color: white;
     font-size: 22px;
     cursor: pointer;
     transition: all 0.3s ease;
     padding: 0;
     line-height: 1;
     flex-shrink: 0;
   }

   .rentals-faq-close:hover {
     background: rgba(255, 255, 255, 0.15);
     border-color: rgba(255, 255, 255, 0.7);
     transform: scale(1.1);
   }

   .rentals-faq-content {
     display: flex;
     flex-direction: column;
     gap: clamp(1.5rem, 3vw, 2rem);
   }

   .rentals-faq-item {
     padding: clamp(1rem, 2vw, 1.5rem) 0;
   }

   .rentals-faq-item:not(:last-child) {
     border-bottom: 1px solid rgba(255, 255, 255, 0.15);
   }

   .rentals-faq-question {
     font-size: clamp(1rem, 1.8vw, 1.3rem);
     font-weight: 600;
     color: white;
     margin: 0 0 clamp(0.5rem, 1vw, 0.75rem) 0;
     text-transform: uppercase;
     letter-spacing: 1px;
   }

   .rentals-faq-answer {
     font-size: clamp(0.9rem, 1.5vw, 1.1rem);
     line-height: 1.8;
     color: rgba(255, 255, 255, 0.9);
     margin: 0;
   }

   .rentals-faq-container::-webkit-scrollbar {
     width: 8px;
   }

   .rentals-faq-container::-webkit-scrollbar-track {
     background: rgba(255, 255, 255, 0.05);
     border-radius: 4px;
   }

   .rentals-faq-container::-webkit-scrollbar-thumb {
     background: rgba(255, 255, 255, 0.3);
     border-radius: 4px;
   }

   .rentals-faq-container::-webkit-scrollbar-thumb:hover {
     background: rgba(255, 255, 255, 0.5);
   }

   @media (max-width: 768px) {
     .rentals-faq-wrapper {
       padding: clamp(1rem, 3vw, 1.5rem);
     }

     .rentals-faq-container {
       padding: clamp(1.5rem, 4vw, 2rem);
       max-height: 90vh;
     }
   }
   
   /* Hide FAQ button when cart is open on mobile */
   @media (max-width: 720px) {
     .rentals-wrapper .rs-cart[data-open="true"] ~ .rentals-faq-float-btn {
       opacity: 0;
       visibility: hidden;
       pointer-events: none;
       transform: translateY(20px);
       transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease;
     }
     
     .rentals-faq-float-btn.cart-open {
       opacity: 0 !important;
       visibility: hidden !important;
       pointer-events: none !important;
       transform: translateY(20px) !important;
     }
   }

   /* Floating FAQ Button */
   .rentals-faq-float-btn {
     position: fixed;
     bottom: clamp(1.5rem, 3vw, 2rem);
     left: clamp(1.5rem, 3vw, 2rem);
     background: #2B3E5E;
     color: white;
     border: 2px solid rgba(255, 255, 255, 0.2);
     border-radius: 50px;
     padding: clamp(0.75rem, 1.5vw, 1rem) clamp(1.25rem, 2.5vw, 1.75rem);
     font-size: clamp(0.9rem, 1.5vw, 1rem);
     font-weight: 700;
     text-transform: uppercase;
     letter-spacing: 1px;
     cursor: pointer;
     z-index: 9999;
     box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
     transition: all 0.3s ease;
     display: flex;
     align-items: center;
     gap: 0.5rem;
   }

   .rentals-faq-float-btn:hover {
     background: #3a5477;
     border-color: rgba(255, 255, 255, 0.4);
     transform: translateY(-2px);
     box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
   }

   .rentals-faq-float-btn:active {
     transform: translateY(0);
   }

   @media (max-width: 768px) {
     .rentals-faq-float-btn {
       bottom: 1.5rem;
       left: 1.5rem;
       padding: 0.875rem 1.5rem;
       font-size: 0.9rem;
     }
   }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <img src="assets/images/logo.png" alt="Rainscope Filmworks" class="logo-img" width="120" height="40" fetchpriority="high">
            </a>
            <button class="mobile-menu-toggle" aria-label="Toggle menu" aria-expanded="false">
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
                <span class="hamburger-line"></span>
            </button>
            <div class="nav-overlay" id="nav-overlay"></div>
            <nav class="nav" id="main-nav">
                <a href="our-work.html" class="nav-link">Our work</a>
                <a href="rentals.html" class="nav-link active">Rentals</a>
                <a href="our-team.html" class="nav-link">Our team</a>
                <a href="contact.html" class="nav-link">Contact us</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="page-content">
        <div class="rentals-wrapper">
            <!-- FAQ Section for First-Time Visitors -->
            <div class="rentals-faq-wrapper" id="rentalsFaqWrapper">
                <div class="rentals-faq-container">
                    <div class="rentals-faq-header">
                        <h2 class="rentals-faq-title">Rental Information</h2>
                        <button class="rentals-faq-close" id="rentalsFaqClose" aria-label="Close FAQ">✕</button>
                    </div>
                    <div class="rentals-faq-content" id="rentalsFaqContent">
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">Can I edit my rental after I submit it?</h3>
                            <p class="rentals-faq-answer">Yep. If you need to adjust your gear list, dates, or contact info, just reply to your confirmation email or message us. We'll update the order on our end and send back the revised details.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">How far in advance should I book gear?</h3>
                            <p class="rentals-faq-answer">For popular items like cameras, lighting kits, and lenses, we recommend booking at least 1–2 weeks ahead. Same-day or next-day bookings are sometimes possible depending on inventory — these are also subject to an additional charge.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">Do you require a deposit?</h3>
                            <p class="rentals-faq-answer">No — But we require your credit card to put on file.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">What happens after I create a rental?</h3>
                            <p class="rentals-faq-answer">Once you submit your order: <strong>1)</strong> We review availability, <strong>2)</strong> You receive a confirmation or suggested changes, <strong>3)</strong> You sign the contract, <strong>4)</strong> Your rental is officially booked. You'll also get check-in and check-out instructions before pickup.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">How does pickup and return work?</h3>
                            <p class="rentals-faq-answer">Pickups and returns happen at our Vancouver office. We'll send you the exact time slot, entry instructions, and any parking notes. If you need an early or late pickup, just ask — we'll try to accommodate.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">What do I need to bring for pickup?</h3>
                            <p class="rentals-faq-answer">A government-issued ID and a credit card used for the payment. If someone else is picking up the order, let us know in advance so we can authorize them.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">What if the gear breaks during my rental?</h3>
                            <p class="rentals-faq-answer">Let us know immediately. We handle repairs in-house or through our trusted techs. Damage is assessed fairly — we don't inflate repair costs. Insurance coverage is recommended for larger packages.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">Can I cancel my order?</h3>
                            <p class="rentals-faq-answer">Yes. Cancellations are free up to 48 hours before pickup. Within 48 hours, the deposit becomes non-refundable due to scheduling and gear lockout.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">What if the gear I want isn't available?</h3>
                            <p class="rentals-faq-answer">We'll offer alternatives or notify you as soon as it becomes available again. We sometimes sub-rent specialty items — just ask.</p>
                        </div>
                        <div class="rentals-faq-item">
                            <h3 class="rentals-faq-question">Do you rent to beginners or first-time filmmakers?</h3>
                            <p class="rentals-faq-answer">Absolutely. Whether you're shooting your first short film or a full commercial, we're here to help you choose the right gear and make sure you're set up for success.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="rs-app" class="rs">
              <header class="rs-top rs-shell">
                <button class="rs-toggle rs-only-mobile" id="rs-open-cats" aria-expanded="false" aria-controls="rs-cats">Filters</button>
                <input id="rs-search" type="search" placeholder="Search gear, kits, lenses…" />
                <button class="rs-toggle rs-only-mobile rs-cart-toggle" id="rs-open-cart" aria-expanded="false" aria-controls="rs-cart">
                  Cart <span id="rs-cart-badge" class="rs-badge" hidden>0</span>
                </button>
              </header>

              <aside class="rs-cats rs-shell" id="rs-cats" aria-label="Categories">
                <div class="rs-cats-head">
                  <span>Categories</span>
                  <button class="rs-close rs-only-mobile" id="rs-close-cats" aria-label="Close filters">✕</button>
                </div>
                <div id="rs-cats-list" class="rs-cats-list" role="tablist"></div>
              </aside>

              <main class="rs-items rs-shell">
                <div id="rs-grid" class="rs-grid" aria-live="polite"></div>
              </main>

              <!-- Cart -->
              <aside class="rs-cart" id="rs-cart" aria-label="Cart / Details" data-open="false">
                <div class="rs-cart-head">
                  <span>Cart <span id="rs-cart-count" class="rs-head-count" hidden>(0)</span> / Details</span>
                  <button class="rs-close rs-only-mobile" id="rs-close-cart" aria-label="Close cart">✕</button>
                </div>

                <div class="rs-cart-scroll">
                  <div id="rs-cart-lines" class="rs-cart-lines"></div>
                </div>

                <div class="rs-cart-footer">
                  <div class="rs-summary">
                    <div>Days: <span id="rs-days">—</span></div>
                    <div>Per-day subtotal: <span id="rs-subday">—</span></div>
                    <div class="rs-total">Estimated total (excl. tax): <strong id="rs-total">—</strong></div>
                  </div>

                  <div class="rs-form">
                    <input id="first" placeholder="First name *" />
                    <input id="last" placeholder="Last name" />
                    <input id="email" type="email" placeholder="Email * (for the estimate)" />
                    <input id="phone" placeholder="Phone (optional)" />
                    <div class="rs-row2">
                      <div class="rs-field">
                        <label class="rs-label">Pickup date *</label>
                        <input id="start" type="date" />
                      </div>
                      <div class="rs-field">
                        <label class="rs-label">Dropoff date *</label>
                        <input id="end" type="date" />
                      </div>
                    </div>
                    <textarea id="note" rows="3" placeholder="Optional notes (delivery, PO, etc.)"></textarea>

                    <div class="rs-actions">
                      <button id="rs-submit" class="rs-btn-primary">Submit for Estimate</button>
                      <span id="rs-status" class="rs-status"></span>
                    </div>
                  </div>
                </div>
              </aside>

              <!-- Toast -->
              <div id="rs-toast" class="rs-toast" hidden>Added to cart</div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-section footer-location">
                <h4>LOCATION</h4>
                <div class="map-container">
                    <iframe 
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2602.1234567890!2d-123.0806155!3d49.2683796!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDnCsDE2JzA2LjIiTiAxMjPCsDA0JzUwLjIiVw!5e0!3m2!1sen!2sca!4v1234567890123!5m2!1sen!2sca" 
                        width="100%" 
                        height="100%" 
                        style="border:0;" 
                        allowfullscreen="" 
                        loading="lazy" 
                        referrerpolicy="no-referrer-when-downgrade"
                        title="Rainscope Filmworks Location Map">
                    </iframe>
                </div>
                <p>1868 Glen Dr #235<br>Vancouver, BC, V6A 4K4</p>
            </div>
            <div class="footer-section footer-hours">
                <h4>HOURS</h4>
                <p>Monday - Friday<br>9am - 5pm</p>
                <p>Saturday - Sunday<br>Upon request</p>
            </div>
            <div class="footer-section footer-contact">
                <h4>CONTACT</h4>
                <p>
                    <a href="mailto:Hello@rainscopefilmworks.com">Hello@Rainscopefilmworks.com</a><br>
                    <a href="mailto:rentals@rainscopefilmworks.com">Rentals@RainscopeFilmworks.com</a>
                </p>
                <div class="social-links">
                    <a href="mailto:Hello@rainscopefilmworks.com" aria-label="Email">
                        <svg viewBox="0 0 64 64" width="32" height="32">
                            <path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z"/>
                        </svg>
                    </a>
                    <a href="https://www.instagram.com/rainscopefilmworks/" target="_blank" aria-label="Instagram">
                        <svg viewBox="0 0 64 64" width="32" height="32">
                            <path d="M46.91,25.816c-0.073-1.597-0.326-2.687-0.697-3.641c-0.383-0.986-0.896-1.823-1.73-2.657c-0.834-0.834-1.67-1.347-2.657-1.73c-0.954-0.371-2.045-0.624-3.641-0.697C36.585,17.017,36.074,17,32,17s-4.585,0.017-6.184,0.09c-1.597,0.073-2.687,0.326-3.641,0.697c-0.986,0.383-1.823,0.896-2.657,1.73c-0.834,0.834-1.347,1.67-1.73,2.657c-0.371,0.954-0.624,2.045-0.697,3.641C17.017,27.415,17,27.926,17,32c0,4.074,0.017,4.585,0.09,6.184c0.073,1.597,0.326,2.687,0.697,3.641c0.383,0.986,0.896,1.823,1.73,2.657c0.834,0.834,1.67,1.347,2.657,1.73c0.954,0.371,2.045,0.624,3.641,0.697C27.415,46.983,27.926,47,32,47s4.585-0.017,6.184-0.09c1.597-0.073,2.687-0.326,3.641-0.697c0.986-0.383,1.823-0.896,2.657-1.73c0.834-0.834,1.347-1.67,1.73-2.657c0.371-0.954,0.624-2.045,0.697-3.641C46.983,36.585,47,36.074,47,32S46.983,27.415,46.91,25.816z M32,39.703c-4.254,0-7.703-3.449-7.703-7.703s3.449-7.703,7.703-7.703s7.703,3.449,7.703,7.703S36.254,39.703,32,39.703z M40.007,25.793c-0.994,0-1.8-0.806-1.8-1.8c0-0.994,0.806-1.8,1.8-1.8c0.994,0,1.8,0.806,1.8,1.8C41.807,24.987,41.001,25.793,40.007,25.793z"/>
                        </svg>
                    </a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Floating FAQ Button -->
    <button class="rentals-faq-float-btn" id="rentalsFaqFloatBtn" aria-label="Open FAQ">
        <span>FAQ</span>
    </button>

    <script src="assets/js/script.js"></script>
    <script>
    /* Robust mobile viewport fallback for --vh */
    (function(){
      function setVH(){
        const vv = window.visualViewport;
        const h = vv ? vv.height : window.innerHeight;
        document.documentElement.style.setProperty('--vh', `${h * 0.01}px`);
      }
      setVH();
      addEventListener('resize', setVH, {passive:true});
      if (window.visualViewport) {
        visualViewport.addEventListener('resize', setVH, {passive:true});
      }
      addEventListener('orientationchange', () => setTimeout(setVH, 120), {passive:true});
    })();
    </script>

    <script>
    // FAQ Auto-Open on First Visit & Floating Button
    document.addEventListener('DOMContentLoaded', function() {
      const faqWrapper = document.getElementById('rentalsFaqWrapper');
      const faqClose = document.getElementById('rentalsFaqClose');
      const faqFloatBtn = document.getElementById('rentalsFaqFloatBtn');
      const faqContainer = faqWrapper ? faqWrapper.querySelector('.rentals-faq-container') : null;
      const FAQ_SEEN_KEY = 'rentals-faq-seen';
      
      if (!faqWrapper || !faqClose) return;
      
      function openFaq() {
        faqWrapper.classList.add('visible');
      }
      
      function closeFaq() {
        faqWrapper.classList.remove('visible');
        // Mark as seen (only on first close)
        if (!localStorage.getItem(FAQ_SEEN_KEY)) {
          localStorage.setItem(FAQ_SEEN_KEY, 'true');
        }
      }
      
      // Check if FAQ has been seen before
      const faqSeen = localStorage.getItem(FAQ_SEEN_KEY);
      
      if (!faqSeen) {
        // Show FAQ on first visit
        setTimeout(() => {
          openFaq();
        }, 300); // Small delay for smooth appearance
      }
      
      // Close button handler
      faqClose.addEventListener('click', closeFaq);
      
      // Floating button handler (always opens FAQ)
      if (faqFloatBtn) {
        faqFloatBtn.addEventListener('click', openFaq);
      }
      
      // Click outside to close
      faqWrapper.addEventListener('click', function(e) {
        if (e.target === faqWrapper) {
          closeFaq();
        }
      });
      
      // Prevent clicks inside container from closing
      if (faqContainer) {
        faqContainer.addEventListener('click', function(e) {
          e.stopPropagation();
        });
      }
    });
    </script>

    <script>
    // Wait for DOM to be fully ready, then initialize
    (async function initRentalsApp() {
      // Ensure DOM is ready
      if (document.readyState === 'loading') {
        await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
      }
      
      (async () => {
      const PROXY_BASE  = "https://rainscope-square-proxy.sweet-queen-15c3.workers.dev";
      const LOCATION_ID = "L5CDX7TRVDN0C";
      const EXCLUDE_CATEGORY_NAMES = ["labour","services","service","A tile on the streets","hidden","stuck on set"];
      const normalize = s => (s||"").toLowerCase().replace(/&/g," and ").replace(/[^a-z0-9]+/g," ").replace(/\s+/g," ").trim();
      const excludeSet = new Set(EXCLUDE_CATEGORY_NAMES.map(normalize));
      
      // Debug mode: set to true to bypass location filtering
      const DEBUG_MODE = false;

      // DOM
      const $cats = document.getElementById("rs-cats-list");
      const $grid = document.getElementById("rs-grid");
      const $search = document.getElementById("rs-search");
      const $lines = document.getElementById("rs-cart-lines");
      const $submit = document.getElementById("rs-submit");
      const $status = document.getElementById("rs-status");
      const $days = document.getElementById("rs-days");
      const $subDay = document.getElementById("rs-subday");
      const $total = document.getElementById("rs-total");
      const $cartPanel = document.getElementById("rs-cart");
      const $openCart = document.getElementById("rs-open-cart");
      const $closeCart = document.getElementById("rs-close-cart");
      const $badge = document.getElementById("rs-cart-badge");
      const $count = document.getElementById("rs-cart-count");
      const $toast = document.getElementById("rs-toast");

      // Debug: Check if DOM elements exist
      console.log("DOM elements check:", {
        cats: !!$cats,
        grid: !!$grid,
        search: !!$search
      });

      if (!$cats || !$grid) {
        console.error("Critical DOM elements missing!");
        if ($grid) $grid.innerHTML = "<em style='color:red;'>Error: Page structure incomplete. Please refresh.</em>";
        return;
      }

      // State
      let objects=[], items=[], categories=[], imagesById={};
      let activeCat="all";
      const cart = JSON.parse(localStorage.getItem("rs_cart") || "[]");

      // Money + totals
      const money = n => n.toLocaleString(undefined,{style:"currency",currency:"CAD"});
      const priceNum = pm => pm && typeof pm.amount==="number" ? pm.amount/100 : 0;
      const MS=86400000;
      const toISO = d => d.toISOString().slice(0,10);
      const parseDate = v => { const d=new Date(v); return isNaN(d)?null:d; };
      // Calculate days in between pickup and dropoff (excluding pickup and dropoff days)
      const dayDiff = (a,b)=>{ 
        const da=new Date(a.getFullYear(),a.getMonth(),a.getDate()); 
        const db=new Date(b.getFullYear(),b.getMonth(),b.getDate()); 
        const daysBetween = Math.round((db-da)/MS);
        // Subtract 1 to exclude pickup and dropoff days, minimum 0
        return Math.max(0, daysBetween - 1);
      };
      const getDays = ()=>{ const s=parseDate(document.getElementById("start").value); const e=parseDate(document.getElementById("end").value); if(!s||!e) return 0; return dayDiff(s,e); };

      // >>> NEW: billable days with 4-day weekly cap
      // 1–4 -> 1–4, 5–7 -> 4; add 4 per full week, remainder capped at 4.
      // e.g., 28 -> 16; 30 -> 18.
      function billableDays(actualDays){
        if (!actualDays) return 0;
        const weeks = Math.floor(actualDays / 7);
        const rem   = actualDays % 7;
        return weeks * 4 + Math.min(4, rem);
      }

      const isPhone = () => matchMedia("(max-width: 720px)").matches;

      function showToast(msg="Added to cart"){
        if(!$toast) return;
        $toast.textContent = msg;
        $toast.hidden = false;
        requestAnimationFrame(()=> $toast.classList.add("show"));
        setTimeout(()=>{ $toast.classList.remove("show"); setTimeout(()=> $toast.hidden=true, 200); }, 1200);
      }

      function itemCatId(it){ return it?.item_data?.category_id
        || it?.item_data?.reporting_category?.id
        || (it?.item_data?.categories?.[0]?.id ?? null); }

      function updateBadges(){
        const units = cart.reduce((n,l)=> n + Math.max(1,parseInt(l.qty||"1",10)), 0);
        if($badge){ if(units>0){ $badge.textContent=String(units); $badge.hidden=false; } else $badge.hidden=true; }
        if($count){ if(units>0){ $count.textContent = `(${units})`; $count.hidden=false; } else $count.hidden=true; }
      }

      // >>> UPDATED: use billableDays() and display "actual (billed)"
      function computeTotals(){
        const daysActual = getDays();
        const daysBill   = billableDays(daysActual);
        const perDay = cart.reduce((sum,l)=> sum + priceNum(l.priceMoney) * Math.max(1,parseInt(l.qty||"1",10)), 0);
        $days.textContent   = daysActual >= 0 ? `${daysActual} (billed ${daysBill})` : "—";
        $subDay.textContent = perDay ? money(perDay) : "—";
        $total.textContent  = (perDay && daysBill) ? money(perDay * daysBill) : "—";
      }

      function saveCart(){ localStorage.setItem("rs_cart", JSON.stringify(cart)); }
      function renderCart(){
        if(!cart.length){ $lines.innerHTML = "<em>No items yet.</em>"; updateBadges(); computeTotals(); return; }
        $lines.innerHTML = cart.map((l,i)=>`
          <div class="rs-line">
            <div>
              <div>${l.name}</div>
              <div style="font-size:12px;color:#6b7280">Price/day: ${l.priceMoney? money(priceNum(l.priceMoney)):"—"}</div>
            </div>
            <input type="number" min="1" data-i="${i}" value="${l.qty}">
            <button class="rs-remove" data-rm="${i}">&times;</button>
          </div>`).join("");
        $lines.querySelectorAll("input[type=number]").forEach(inp=>{
          inp.onchange=e=>{ const i=+e.target.dataset.i; cart[i].qty=String(Math.max(1,parseInt(e.target.value||"1",10))); saveCart(); updateBadges(); computeTotals(); };
        });
        $lines.querySelectorAll("[data-rm]").forEach(btn=>{
          btn.onclick=()=>{ cart.splice(+btn.dataset.rm,1); saveCart(); renderCart(); };
        });
        updateBadges(); computeTotals();
      }

      function openCart(){
        $cartPanel.dataset.open = "true";
        document.documentElement.classList.add('rs-lock');
        document.body.classList.add('rs-lock');
        $openCart?.setAttribute("aria-expanded","true");
        // Close FAQ and hide FAQ button on mobile when cart opens
        const faqWrapper = document.getElementById('rentalsFaqWrapper');
        const faqFloatBtn = document.getElementById('rentalsFaqFloatBtn');
        if (faqWrapper) faqWrapper.classList.remove('visible');
        if (faqFloatBtn) faqFloatBtn.classList.add('cart-open');
      }
      function closeCart(){
        $cartPanel.dataset.open = "false";
        document.documentElement.classList.remove('rs-lock');
        document.body.classList.remove('rs-lock');
        $openCart?.setAttribute("aria-expanded","false");
        // Show FAQ button again when cart closes
        const faqFloatBtn = document.getElementById('rentalsFaqFloatBtn');
        if (faqFloatBtn) faqFloatBtn.classList.remove('cart-open');
      }

      function addToCart(variationId, name, priceMoney){
        const line = cart.find(l=>l.variationId===variationId);
        if(line) line.qty = String((+line.qty||1)+1);
        else cart.push({variationId,name,priceMoney,qty:"1"});
        saveCart(); renderCart(); showToast();
      }

      async function loadCatalog(){
        try {
          console.log("Loading catalog from:", `${PROXY_BASE}/api/catalog`);
          $grid.innerHTML = "<em>Loading catalog...</em>";
          
          const response = await fetch(`${PROXY_BASE}/api/catalog?bust=${Date.now()}`);
          
          if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
          }
          
          const data = await response.json();
          console.log("API Response:", data);
          
          if (!data || typeof data !== 'object') {
            throw new Error("Invalid API response format");
          }
          
          objects    = Array.isArray(data.objects) ? data.objects : [];
          console.log(`Loaded ${objects.length} objects from API`);
          
          imagesById = Object.fromEntries(objects.filter(o=>o.type==="IMAGE" && o.image_data).map(o=>[o.id,o]));
          categories = objects.filter(o => o.type==="CATEGORY" && !o.is_deleted && o.category_data);
          const itemsRaw = objects.filter(o => o.type==="ITEM" && !o.is_deleted && o.item_data);
          
          console.log(`Found ${categories.length} categories and ${itemsRaw.length} items`);

          const nameById = Object.fromEntries(categories.map(c => [c.id, c.category_data.name]));

          items = itemsRaw.filter(it=>{
            const pt=(it.item_data?.product_type||"REGULAR").toUpperCase();
            if(pt!=="REGULAR") {
              console.log(`Item ${it.item_data?.name} filtered: product_type is ${pt}`);
              return false;
            }
            const cid=itemCatId(it);
            if(cid){
              const norm=normalize(nameById[cid]||"");
              if(excludeSet.has(norm)) {
                console.log(`Item ${it.item_data?.name} filtered: category "${nameById[cid]}" is excluded`);
                return false;
              }
            }
            
            // Location filtering
            if (!DEBUG_MODE) {
              const locs=it.present_at_location_ids||it.item_data?.present_at_location_ids||[];
              const absent=it.absent_at_location_ids||it.item_data?.absent_at_location_ids||[];
              if(absent.includes(LOCATION_ID)) {
                console.log(`Item ${it.item_data?.name} filtered: absent at location ${LOCATION_ID}`);
                return false;
              }
              const locationMatch = (locs.length===0 || locs.includes(LOCATION_ID));
              if (!locationMatch) {
                console.log(`Item ${it.item_data?.name} filtered: not present at location ${LOCATION_ID}`, {locs, LOCATION_ID});
              }
              return locationMatch;
            } else {
              console.log(`DEBUG MODE: Item ${it.item_data?.name} included (location filtering bypassed)`);
              return true;
            }
          });
          
          console.log(`After filtering: ${items.length} items remain (from ${itemsRaw.length} raw items)`);
          if (items.length === 0 && itemsRaw.length > 0) {
            console.warn("All items were filtered out! Check filtering logic.");
            console.log("Sample raw item:", itemsRaw[0]);
          }

          const counts=new Map(); let unassigned=0;
          for(const it of items){
            const cid=itemCatId(it);
            if(cid){
              const norm=normalize(nameById[cid]||"");
              if(excludeSet.has(norm)) continue;
              counts.set(cid,(counts.get(cid)||0)+1);
            } else unassigned++;
          }

          const chips=[{id:"all",name:"All",count:items.length}];
          const entries=[...counts.entries()].map(([cid,n])=>({id:cid,name:nameById[cid]||"Category",count:n}));
          entries.sort((a,b)=>a.name.localeCompare(b.name));
          chips.push(...entries);
          if(unassigned>0) chips.push({id:"__unassigned",name:"Unassigned",count:unassigned});

          if (!$cats) {
            console.error("Categories container not found!");
            return;
          }

          $cats.innerHTML = chips.map(c=>`
            <button class="rs-cat ${c.id===activeCat?'active':''}" data-cat="${c.id}" role="tab" aria-selected="${c.id===activeCat}">
              <span>${c.name}</span> <span class="rs-count">${c.count}</span>
            </button>`).join("");

          $cats.querySelectorAll("[data-cat]").forEach(b=>{
            b.onclick=()=>{ activeCat=b.dataset.cat; $cats.querySelectorAll(".rs-cat").forEach(x=>x.classList.remove("active")); b.classList.add("active"); renderGrid(); };
          });
          
          console.log(`Rendered ${chips.length} category chips`);
        } catch (error) {
          console.error("Error loading catalog:", error);
          const errorMsg = error.message || "Unknown error";
          
          // Check for CORS error
          let displayMsg = errorMsg;
          if (errorMsg.includes("Failed to fetch") || errorMsg.includes("CORS")) {
            const isLocalFile = window.location.protocol === "file:";
            if (isLocalFile) {
              displayMsg = "CORS Error: This page must be served from a web server (not opened as a file). The API only allows requests from https://rainscopefw.squarespace.com. This will work when deployed to your website.";
            } else {
              displayMsg = "CORS Error: The API server is not allowing requests from this origin. Please check the API CORS configuration.";
            }
          }
          
          if ($grid) {
            $grid.innerHTML = `<div style='color:red; padding: 2rem; text-align: center;'><strong>Error loading catalog:</strong><br>${displayMsg}<br><br><small>Check the browser console for more details.</small></div>`;
          }
          if ($cats) {
            $cats.innerHTML = "<em style='color:red;'>Unable to load categories</em>";
          }
        }
      }

      function inCat(it){
        if(activeCat==="all") return true;
        if(activeCat==="__unassigned") return !itemCatId(it);
        return itemCatId(it)===activeCat;
      }

      function renderGrid(){
        if (!$grid) {
          console.error("Grid container not found!");
          return;
        }
        
        console.log(`renderGrid called with ${items.length} items, activeCat: ${activeCat}`);
        
        const q=($search?.value||"").toLowerCase().trim();
        const list=items.filter(it=>{
          if(!inCat(it)) {
            console.log(`Item ${it.item_data?.name} filtered by category`);
            return false;
          }
          if(!q) return true;
          const nameMatch = (it.item_data?.name||"").toLowerCase().includes(q);
          if (!nameMatch) {
            console.log(`Item ${it.item_data?.name} filtered by search query: "${q}"`);
          }
          return nameMatch;
        });

        console.log(`Rendering ${list.length} items (filtered from ${items.length} total, search: "${q}")`);

        if(!list.length){ 
          if (items.length === 0) {
            $grid.innerHTML="<em>No items available. Please check the console for details.</em>"; 
          } else {
            $grid.innerHTML="<em>No items match your search or category filter.</em>"; 
          }
          return; 
        }
        list.sort((a,b)=> (a.item_data?.name||"").localeCompare(b.item_data?.name||""));

        $grid.innerHTML = list.map(item=>{
          const vars=item.item_data?.variations||[];
          const first=vars[0];
          const imgId=item.item_data?.image_ids?.[0];
          const img=imgId?(imagesById[imgId]?.image_data?.url||""):"";
          const title=item.item_data?.name||"Item";

          const opts = vars.map(v=>{
            const d=v.item_variation_data||{};
            const p=d.price_money||null;
            const pjson = p ? JSON.stringify(p).replace(/"/g,'&quot;') : "";
            const priceTxt = p ? (p.amount/100).toLocaleString(undefined,{style:"currency",currency:"CAD"}) : "";
            return `<option value="${v.id}" data-price="${pjson}">${d.name||"Default"}${priceTxt? " — "+priceTxt:""} / day</option>`;
          }).join("");

          const firstPrice = first?.item_variation_data?.price_money || null;

          return `
            <div class="rs-card">
              ${img? `<img class="rs-img" loading="lazy" src="${img}" alt="${title}">` : `<div class="rs-img"></div>`}
              <div class="rs-body">
                <div class="rs-title">${title}</div>
                <select class="rs-variant" data-item="${item.id}">${opts}</select>
                <div class="rs-row">
                  <div class="rs-price" data-price-for="${item.id}">${firstPrice? (firstPrice.amount/100).toLocaleString(undefined,{style:"currency",currency:"CAD"})+" / day":""}</div>
                  <button class="rs-add" data-add="${item.id}">Add</button>
                </div>
              </div>
            </div>`;
        }).join("");

        $grid.querySelectorAll(".rs-variant").forEach(sel=>{
          sel.onchange=()=>{
            const itemId=sel.getAttribute("data-item");
            const opt=sel.options[sel.selectedIndex];
            const priceStr=opt.getAttribute("data-price");
            const priceObj=priceStr? JSON.parse(priceStr.replaceAll('&quot;','"')) : null;
            const el=$grid.querySelector(`[data-price-for="${itemId}"]`);
            if(el) el.textContent = priceObj ? (priceObj.amount/100).toLocaleString(undefined,{style:"currency",currency:"CAD"})+" / day" : "";
          };
        });
        $grid.querySelectorAll("[data-add]").forEach(btn=>{
          btn.onclick=()=>{
            const itemId=btn.getAttribute("data-add");
            const item=items.find(i=>i.id===itemId);
            const sel=$grid.querySelector(`.rs-variant[data-item="${itemId}"]`);
            const varId=sel.value;
            const v=(item.item_data?.variations||[]).find(x=>x.id===varId);
            const name=`${item.item_data?.name||"Item"} — ${(v?.item_variation_data?.name)||"Default"}`;
            const p=v?.item_variation_data?.price_money||null;
            addToCart(varId,name,p);
          };
        });
      }

      // Submit
    async function submit() {
      const setStatus = m => { if ($status) $status.textContent = m; };

      try {
        const given_name   = document.getElementById("first").value.trim();
        const family_name  = document.getElementById("last").value.trim();
        const email_address= document.getElementById("email").value.trim();
        const phone_number = document.getElementById("phone").value.trim() || undefined;
        let   startStr     = (document.getElementById("start").value || "").trim();
        let   endStr       = (document.getElementById("end").value   || "").trim();
        const noteExtra    = document.getElementById("note").value.trim();

        if (!given_name || !email_address) { alert("First name and email are required."); return; }
        if (!cart.length)                  { alert("Add at least one item."); return; }
        if (!startStr || !endStr)          { alert("Choose pickup and dropoff dates."); return; }
        if (startStr > endStr)             { alert("Dropoff date must be on/after pickup date."); return; }

        // ensure yyyy-mm-dd (type="date" already provides this in most browsers)
        startStr = startStr.slice(0, 10);
        endStr   = endStr.slice(0, 10);

        setStatus("Creating customer…");
        const cust = await fetch(`${PROXY_BASE}/api/customer`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ given_name, family_name, email_address, phone_number })
        }).then(r => r.json());

        if (!cust?.customer_id) {
          alert("Estimate failed: could not create/find customer.");
          setStatus("");
          return;
        }

        // >>> UPDATED: use billed days (days in between pickup and dropoff)
        const daysActual = getDays();
        if (daysActual < 0) {
          alert("Invalid date range. Dropoff date must be after pickup date.");
          setStatus("");
          return;
        }
        const daysBill = billableDays(daysActual);

        const line_items = cart.flatMap(l => {
          const units = Math.max(1, parseInt(l.qty || "1", 10));
          const base  = { catalog_object_id: l.variationId, quantity: String(daysBill) };
          return Array.from({ length: units }, () => base);
        });

        // >>> UPDATED: note shows pickup/dropoff dates and days in between
        const note = `Rental: Pickup ${startStr}, Dropoff ${endStr} (${daysActual} day${daysActual !== 1 ? 's' : ''} in between, billed ${daysBill}). ${noteExtra || ""}`.trim();

        // Calculate service date (first billable day = day after pickup)
        const pickupDate = parseDate(startStr);
        const serviceDate = pickupDate ? new Date(pickupDate.getTime() + MS) : null;
        const serviceDateStr = serviceDate ? toISO(serviceDate) : null;

        setStatus("Submitting estimate…");
        const res = await fetch(`${PROXY_BASE}/api/estimate`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            customer_id: cust.customer_id,
            location_id: LOCATION_ID,
            line_items,
            note,
            publish: true,
            delivery_method: "EMAIL",
            // start_date: invoice payment due date (pickup date)
            start_date: startStr,
            // service_date: first billable day (day after pickup)
            service_date: serviceDateStr
          })
        });

        const data = await res.json();

        if (!data?.ok) {
          // Surface worker/Square error message if present
          alert("Estimate failed:\n" + (data?.error || `HTTP ${res.status}`));
          setStatus("");
          return;
        }

        setStatus("Estimate sent!");
        alert("Estimate emailed. Thank you!");
        cart.length = 0; saveCart(); renderCart(); computeTotals();
        if (isPhone()) closeCart();

      } catch (err) {
        alert("Estimate failed:\n" + (err?.message || String(err)));
        setStatus("");
      }
    }
      // Init
      try{
        console.log("Initializing rentals app...");
        const today=new Date(), tomorrow=new Date(Date.now()+MS);
        const s=document.getElementById("start"), e=document.getElementById("end");
        if(s && e && !s.value && !e.value){ s.value=toISO(today); e.value=toISO(tomorrow); }
        await loadCatalog();
        renderGrid();
        console.log("Rentals app initialized successfully");
      }catch(e){ 
        console.error("Initialization error:", e);
        if ($grid) {
          $grid.innerHTML = `<em style='color:red;'>Failed to initialize: ${e.message}</em>`;
        }
      }

      if ($search) {
        $search.addEventListener("input", ()=> renderGrid());
      }
      if ($submit) {
        $submit.addEventListener("click", submit);
      }
      const $start = document.getElementById("start");
      const $end = document.getElementById("end");
      if ($start) {
        $start.addEventListener("change", computeTotals);
      }
      if ($end) {
        $end.addEventListener("change", computeTotals);
      }

      // Open/close
      document.getElementById("rs-open-cats")?.addEventListener("click", ()=>{ 
        const cats = document.getElementById("rs-cats");
        if (cats) {
          const isExpanded = document.getElementById("rs-open-cats").getAttribute("aria-expanded") === "true";
          document.getElementById("rs-open-cats").setAttribute("aria-expanded", !isExpanded);
        }
      });
      document.getElementById("rs-close-cats")?.addEventListener("click", ()=>{ 
        document.getElementById("rs-open-cats")?.setAttribute("aria-expanded", "false");
      });
      document.getElementById("rs-open-cart")?.addEventListener("click", ()=>{ ($cartPanel.dataset.open==="true") ? closeCart() : openCart(); });
      document.getElementById("rs-close-cart")?.addEventListener("click", ()=> closeCart());

      // Tap outside to close on phone
      addEventListener("click",(e)=>{
        if (!isPhone()) return;
        if($cartPanel.dataset.open==="true" && !e.target.closest("#rs-cart,#rs-open-cart")) closeCart();
      },{passive:true});

      renderCart();
      computeTotals();
      })();
    })();
    </script>
</body>
</html>
